#include <tunables/global>

profile hassio-addon flags=(attach_disconnected,mediate_deleted) {
  # Allow executing the CUPS daemon
  /usr/sbin/cupsd rix,

  # CUPS config and runtime directories
  /etc/cups/** r,
  /var/spool/cups/** rwk,
  /var/log/cups/** rw,
  /run/cups/** rw,

  # Library locations
  /usr/lib/** rm,
  /usr/local/lib/** rm,

  # Access to device nodes for USB printers
  # USB passthrough is disabled by default to reduce the add-on's attack surface.
  # To enable USB passthrough, re-add the following line and enable usb in config.yaml:
  # /dev/bus/usb/** rw,

  # Allow network access (necessary for printing and Avahi/mDNS)
  network inet stream,
  network inet6 stream,

  # Allow read access to CA certs (for TLS)
  /etc/ssl/** r,

  # Deny obvious sensitive data
  deny /etc/shadow r,
  deny /etc/gshadow r,

  # Allow subprocesses and program lifetime management
  capability net_bind_service,
  capability setgid,
  capability setuid,
  
  # Vaak nodig voor CUPS
  capability chown,
  capability dac_override,
  capability fowner,
}
