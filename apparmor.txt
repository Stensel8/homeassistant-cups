#include <tunables/global>

profile hassio-addon flags=(attach_disconnected,mediate_deleted) {
  # ==========================================
  # S6-Overlay v3+ support
  # ==========================================
  /init rix,
  /run/s6/** rwix,
  /run/s6-rc/** rwix,
  /etc/s6/** rix,
  /etc/s6-overlay/** rix,
  /package/** rix,
  /command/** rix,
  /var/run/s6/** rwix,
  
  # ==========================================
  # Shell and system binaries
  # ==========================================
  /bin/** rix,
  /sbin/** rix,
  /usr/bin/** rix,
  /usr/sbin/** rix,
  /usr/local/bin/** rix,
  /usr/local/sbin/** rix,
  
  # ==========================================
  # Bashio support (Home Assistant helper)
  # ==========================================
  /usr/lib/bashio/** rix,
  /tmp/bashio/** rw,
  
  # ==========================================
  # CUPS daemon and binaries
  # ==========================================
  /usr/sbin/cupsd rix,
  /usr/sbin/cups-browsed rix,
  /usr/lib/cups/** rix,
  /usr/lib/cups/backend/** rix,
  /usr/lib/cups/driver/** rix,
  /usr/lib/cups/filter/** rix,
  /usr/lib/cups/notifier/** rix,
  
  # ==========================================
  # CUPS configuration and runtime
  # ==========================================
  /etc/cups/** rw,
  /var/spool/cups/** rwk,
  /var/cache/cups/** rwk,
  /var/log/cups/** rw,
  /run/cups/** rw,
  /var/run/cups/** rw,
  /tmp/cups/** rwk,
  
  # ==========================================
  # Library locations
  # ==========================================
  /lib/** rm,
  /lib64/** rm,
  /usr/lib/** rm,
  /usr/lib64/** rm,
  /usr/local/lib/** rm,
  
  # ==========================================
  # Home Assistant add-on directories
  # ==========================================
  /data/** rw,
  /config/** r,
  /ssl/** r,
  /addons/** r,
  /backup/** r,
  /share/** rw,
  /media/** r,
  
  # ==========================================
  # System directories
  # ==========================================
  /etc/** r,
  /proc/** r,
  /sys/** r,
  /dev/** rw,
  /tmp/** rwk,
  /var/tmp/** rwk,
  /run/** rw,
  /var/run/** rw,
  
  # ==========================================
  # USB printer support (uncomment to enable)
  # ==========================================
  # /dev/bus/usb/** rw,
  # /dev/usb/** rw,
  # /dev/lp* rw,
  
  # ==========================================
  # Network access
  # ==========================================
  network inet stream,
  network inet dgram,
  network inet6 stream,
  network inet6 dgram,
  network netlink raw,
  network unix stream,
  network unix dgram,
  
  # ==========================================
  # SSL/TLS certificates
  # ==========================================
  /etc/ssl/** r,
  /etc/pki/** r,
  /usr/share/ca-certificates/** r,
  
  # ==========================================
  # DNS resolution
  # ==========================================
  /etc/hosts r,
  /etc/resolv.conf r,
  /etc/nsswitch.conf r,
  
  # ==========================================
  # Capabilities (minimum required for CUPS)
  # ==========================================
  capability chown,
  capability dac_override,
  capability dac_read_search,
  capability fowner,
  capability fsetid,
  capability kill,
  capability net_bind_service,
  capability net_admin,
  capability setgid,
  capability setuid,
  capability sys_chroot,
  capability sys_resource,
  
  # ==========================================
  # Signals (for process management)
  # ==========================================
  signal send set=(term,kill,hup),
  signal receive set=(term,kill,hup,usr1,usr2),
  
  # ==========================================
  # Ptrace (for debugging, optional)
  # ==========================================
  ptrace read,
  
  # ==========================================
  # Explicitly denied access
  # ==========================================
  deny /etc/shadow r,
  deny /etc/gshadow r,
  deny /root/.ssh/** r,
  deny /home/**/.ssh/** r,
  
  # ==========================================
  # Mount operations (required for S6)
  # ==========================================
  mount,
  remount,
  umount,
}
